
## История возникновения Android

Изначально разработкой **OC Android** занималась компания **Android Inc.** B 2005 году Google выкупила **Android** за $130 млн.

Как отметил **Дэвид Лаве**, вице-президент компании, на симпозиуме в Стэнфорде: 

> «Приобретение **Android** - это самое значительное приобретение **Google** за все время существовани компании».

Однако днем рождения ОС принято считать другую дату - **05 ноября 2007 г.**, когда Google объявила о создании **O**pen **H**andset **A**lliance (**OHA**) - группы компаний, занимающихся разработкой стандартов ПО для мобильных устройств.

**ОНА** представляет собой сообщество из более чем 50 компаний, включающее производителей программного и аппаратного обеспечения, а также мобильных операторов. Среди наиболее значительных членов Альянса можно назвать компании **Motorola**, **HTC**, **Qualcomm**, **T-Mobile, Blackberry, Nokia.**


## Архитектура Android

С точки зрения архитектуры **Android** является программным стеком для мобильных устройств, который включает операционную систему, связующее ПО и ключевые приложения.

Набор инструментов разработки под **Android** (**Android SDK**)
содержит инструменты и интерфейсы прикладного программирования (**API**), требуемые для разработки приложений на платформе **Android**.

> [!info]
> **SDK (software development kit)** —  набор средств разработки, позволяющий специалистам по программному обеспечению создавать приложения для определённого пакета программ, программного обеспечения базовых средств разработки, аппаратной платформы, компьютерной системы, игровых консолей, операционных систем и прочих платформ.
>
> **Android SDK** — это эмулятор и среда разработки приложений для операционной системы Андроид одновременно.

> [!info]
> **Java Development Kit (JDK)** — это среда разработки программного обеспечения, используемая для разработки приложений и апплетов Java. Он включает в себя среду выполнения Java (JRE), интерпретатор / загрузчик (Java), компилятор (javac), архиватор (jar), генератор документации (Javadoc) и другие инструменты, необходимые для разработки Java.

## Особенности платформы Android

В состав Android входят разнообразные компоненты, интересные для разработчиков:

- **Фреймворк приложений**, позволяющий повторно использовать и взаимо-заменять программные компоненты. Фреймворк это набор всевозможных библиотек (инструментов) для быстрой разработки повседневных (рутинных) задач
- **Виртуальная машина** `Dalvik` (использовалась до версии **Android 4.4**), оптимизированная для работы на мобильных устройствах, которая является промежуточным слоем. Благодаря использованию виртуальной машины: для выполнения кода программы, разработчики получают в свое распоряжение уровень абстракции, позволяющий не беспокоиться об особенностях конструкции различных устройств.
- **Оптимизированная графическая подсистема** на базе собственной библиотеки для работы с двухмерной графикой, 3D-графика реализована на базе библиотеки `OpenGL ES` (с возможной поддержкой аппаратного ускорения).
- Реляционная встраиваемая СУБД `SQLite` для хранения и обработки структурированных данных
- Встроенная поддержка **различных аудио- и видеоформатов**, а также статических изображений (MPEG4, MP3, AAC, AMR, JPG, PNG, GIF).
- В зависимости от оборудования, могут поддерживаться технологии беспроводной передачи данных (Bluetooth, 3G и Wi-Fi).
- Поддержка камеры с возможностью **фото/видеосъемки, GPS, компаса и акселерометра.**
- Мощная **среда разработки**, включающая, в том числе, **эмулятор** (виртуальных) устройств различными (настраиваемыми) характеристиками, инструменты для отладки и профилирования приложения.

> [!info]
> **Акселерометр (англ. accelerometer)**, с технической точки зрения, представляет из себя устройство, способное измерять ускорение предмета, которое оно приобретает при смещении относительно своего нулевого положения.
> > [!tip]
> > **Акселерометр** применяется как для измерения ускорения в сторону, в которую произошло смещение, так и для измерения ускорения, вызванного силой тяжести Земли.

Данные свойства и простая конструкция акселерометров позволяет их использовать в мобильных устройствах. 

> **Основная функция**, которую может выполнять акселерометр — реакция устройства на изменения его ориентации в пространстве (поворот дисплея, встряхивание, удар), что позволяет в нужный момент повернуть экран, так как было бы удобно пользователю; обеспечить работу устройства в качестве шагомера; отобразить текущее положение устройства в пространстве.

На данный момент технологии позволяют массово производить **акселерометры** на основе MEMS (микро-, электромеханических систем). Это удешевляет их использование в современных мобильных телефонах, навигаторах, плеерах, компактных компьютерах для спортсменов, пультах к игровым приставкам и др. устройствах.

## Рабочая среда (Runtime Environment, RTE)

> [!tip]
> Android включает в себя **набор библиотек**, которые обеспечивает большинство runtime- функций, доступных в основных библиотеках языка программирования Java.

Каждое приложение **Android** выполняется в собственном процессе, со своим собственным экземпляром виртуальной машины `Dalvik`. BM `Dalvik` была спроектирована и написана таким образом, чтобы внутри мобильного устройства могли эффективно работать несколько виртуальных машин. 

Виртуальная машина `Dalvik` может выполнять программы исполняемом формате **DEX** (**D**alvik **Ex**ecutable). Данный Формат оптимизирован для использования минимального объема памяти. 

> [!tip]
> **Исполняемый файл** с расширением `.dex` создается путем компиляции классов Java с помощью инструмента dx, входящего в состав `Android SDK`

> [!info]
> **Android Runtime** — среда выполнения Android-приложений, разработанная компанией Google как замена `Dalvik`. ART впервые появился в Android 4.4 как тестовая функция, а в Android 5.0 полностью заменил `Dalvik`. В отличие от `Dalvik`, который использует ЛТ-компиляцию(Во время выполнения приложения).
**ART** компилирует приложение во время его установки. За счет этого планируется повышение скорости работы программ и одновременно увеличение времени работы от батареи. **Недостатком** является более долгая загрузка устройства.


> [!info]
> **JIT-компиляция** — технология увеличения производительности программных систем, использующих байт-код, путём компиляции байт-кода в машинный код или в другой формат непосредственно во время работы программы.

## APK

**Расширение АРK** (Android package) файла связано с операционной системой смартфона Google Android, разработанный компанией **Google** и **Open Handset Alliance**.

> [!info]
> **АРК-файл** представляет собой архив, содержащий исходные данные Android приложения (скомпилированные файлы с кодом DEX, скомпилированные файлы ресурсов ARSC, файлы настроек AndroidManifest.xml).

Весь код в одном файле `.apk` считается одним приложением и этот файл используется для установки данного приложения на устройствах с ОС Android.

Файлы **АРК** хранятся в каталоге **/data/app**. Каталог «арр» доступен только через проводник.

## Android

> [!info]
> **Система Android** — это многопользовательская Linux-система, в которой каждое приложение работает с правами уникального пользователя. В Android реализована характерная для Unix-подобных ОС система базовая безопасности и управления доступом, в которой:
> 
> - все в системе является файлом, который обязательно принадлежит какому-то пользователю (имеет соответствующий User ID, UID)
> 
> - Любой процесс в системе обязательно работает с правами какого-то пользователя.

С помощью описанного механизма Android реализует принцип наименьших привилегий: каждое приложение по умолчанию имеет доступ **только к тем** компонентам, которые требуется для выполнения его задач, и не более. 

> [!tip]
> Это создает **очень безопасную среду**, в которой приложение не может получить доступ к частям системы, для которых оно не имеет разрешения.
> 
> Тем не менее, для приложений существуют механизмы для обмена данными с другими и для доступа к системным сервисам:

- **Двум (или более, при необходимости) приложениям** можно присвоить один и тот же UID, в этом случае они смогут получать Доступ к файлам друг друга. Чтобы сэкономить системные ресурсы, приложения с одним и тем же UID можно также настроить на исполнение в одном и том же процессе Linux в одной и той же виртуальной машине (при этом приложения должны быть подписаны и одним и тем же сертификатом разработчика).
- **Приложение может запросить разрешение (Permissions)** на доступ к данным в устройстве, таким как контакты пользователя, SMS сообщения, сменные носители информации (SD карты), камера, Bluetooth, и многое другое. Все подобные заявки на доступ к ресурсам проверяются и разрешаются пользователем в ОС Android во время установки приложения. Если приложение установлено, пользователя больше не будут спрашивать о пересмотре этих полномочий.

Необходимые приложению полномочия (как и многое другое) **указываются в файле Манифеста приложения (AndroidManifest.xml)**. Этот файл обязательно должен присутствовать для любого приложения Android. Android SDK предоставляет разработчику богатый арсенал средств для управления содержимым этого файла.

> [!tip]
> Кроме того, поскольку файл манифеста **является обычным XML-файлом**, необходимую информацию в нем можно указывать с помощью обычного редактора (SDK и в этом случае позволяет редактировать этот файл с большим комфортом).

Чтобы использовать ресурсы системы и других приложений, требуется добавить тэги <uses-permission> в манифест своего приложения, указывая требуемые полномочия. Стандартные имена для описания полномочий, используемых системными Активностями(Activity) и сервисами в Android можно найти в классе android.Manifest.permission в виде статических строковых констант и по адресу:

http://developer.android.com/reference/android/Manifest.permission.html

#### Пример

Объявление запрашиваемого приложением полномочия для доступа в Internet 
(в файле AndroidManifest.xml): 

```xml
<manifest xmlns:android="[http://schemas.android.com/apk/res/android](http://schemas.android.com/apk/res/android)" package="com.android.app.myapp" >
<uses-permission android:name="android.permission.INTERNET" />
...
</manifest>
```

### Активности (Activity) в Android

При создании экранов графического интерфейса пользователя наследуется класс `Activity` и используются представления (View) для взаимодействия с пользователем. 

Каждая Активность — **это экран** (по аналогии с Формой), который приложение может показывать пользователям. Чем сложнее создаваемое приложение, тем больше экранов (Активностей) потребуется. 

> [!tip]
> При создании приложения потребуется, как минимум, **начальный (главный) экран**, который обеспечивает основу пользовательского интерфейса приложения.
> 
> Большинство активностей проектируются таким образом, чтобы использовать все экранное пространство, но можно также создавать полупрозрачные или плавающие диалоговые окна.

### Жизненный цикл Активности

Для создания приложений, правильно управляющих ресурсами предоставляющих пользователю удобный интерфейс, важно хорошее понимание **жизненного цикла** Активности. Это связано с тем, что приложения Android **не могут** **контролировать** 
свой жизненный цикл, ОС сама управляет всеми процессами и, как следствие, Активностями внутри них. 

> При этом, состояние Активности помогает ОС определить приоритет родительского для этой Активности Приложения (Application).
> 
> А приоритет Приложения влияет на то, с какой вероятностью его работа (и работа дочерних Активностей) будет прервана системой.

### Состояние каждой Активности

Состояние каждой Активности определяется ее позицией в стеке (LIFO) Активностей, запущенных в данный момент.

При запуске новой Активности представляемый ею экран помещается на вершину стека. Если пользователь нажимает кнопку «назад» или эта Активности закрывается каким-то другим образом, на вершину стека перемещается (и становится активной) нижележащая Активность.

### Четыре возможных состояния Активности

Активности могут находиться в одном из этих состояний:

- **Активное (Active)**. Активность находится на переднем плане (на вершине стека) и имеет возможность взаимодействовать с пользователем. Android будет пытаться сохранить ее работоспособность любой ценой, при необходимости прерывая работу других Активностей, находящихся на более низких позициях в стеке для предоставления необходимых ресурсов.
    
    > При выходе на передний план другой Активности работа данной Активности будет приостановлена или остановлена.
    
- **Приостановленное (Paused)**. Активность может быть видна на экране, но не может взаимодействовать с пользователем: в этот момент она приостановлена. Это случается, когда на переднем плане находятся полупрозрачные или плавающие (например, диалоговые) окна. Работа приостановленной Активности может быть прекращена, если ОС необходим выделить ресурсы Активности переднего плана. Если Активность полностью исчезает с экрана, **она останавливается**.

- **Остановленное (Stopped).** Активность невидима, она находится в памяти, сохраняя информацию о своем состоянии. Такая Активность становится кандидатом на преждевременное закрытие, если системе потребуется память для чего-то другого.
    
    > При остановке Активности разработчику важно сохранить данные и текущее состояние пользовательского интерфейса (состояние полей ввода, позицию курсора и т. д.). Если Активность завершает свою работу или закрывается, она становится *неактивной*.
    
- **Неактивное (Inactive)**. Когда работа Активности завершена, и перед тем, как она будет запущена, данная Активность находится в неактивном состоянии. Такие Активности удаляются из стека и должны быть (пере)запущены, чтобы их можно было использовать.
### Фрагменты

> [!info]
> **Fragment (Фрагмент)** — это подобие Activity, которое мы можем подключать в разные части приложения. Но одно Activity может содержать несколько fragment.
> 
> Фрагменты появились в API 11 (Android 3.0) для поддержки на более старых версиях был доработан Android Support library.

Также важно понимать, что фрагменты это не замена активности, они не могут существовать сами по себе, а только вместе с Activity.

### AndroidManifest.xml

Файл `AndroidManifest.xml` является одним из **самых важных** в Android проекте. В нем содержится информация о пакетах приложения, компонентах типа `Activity, Service`.

Файл `AndroidManifest.xml` выполняет следующие задачи:

- Предоставляет разрешения приложению на использование или доступ к другим компонентам системы.
- Определяет как будут запускаться, например, Activity (какие фильтры использовать).

### MainActivity.java

Папка `Java` содержит исходный код приложения. Классы могут быть расположены в различных пакетах, но обязательно внутри папки `Java`.

### Activity_main.xml

**Разметка** (также используются термины **компоновка** или **макет**) хранится в виде **XML-файла** в папке `/res/layout`. Это сделано для того, чтобы отделить код от дизайна, как это принято во многих технологиях (HTML и CSS, Visual Studio).

### Папка res

B папке `res` расположены все используемые приложением ресурсы, включая изображения, различные xml файлы, анимации, звуковые файлы и многие другие.

Внутри папки res эти все ресурсы распределены по своим папкам:

- Папка `drawable` содержит файлы с изображениями, которые будет использоваться в приложении.
- Папка `layout`располагает xml файлами, которые используются для построения пользовательского интерфейса Android приложения.
- В папке `menu` находятся xml файлы, используемые только для создания меню.
- В `mipmap` папке хранят только значки приложения. Любые
другие drawable элементы должны быть размещены в своей папке.
- `values` хранит те xml файлы, в которых определяются простые значения типа строк, массивов, целых чисел, размерностей, цветов и стилей.

### Gradle

Скрипты **Gradle** используются для автоматизации сборки проекта.

Android Studio выполняет сборку приложения в фоновом режиме без какого-либо вмешательства со стороны разработчика. Этот процесс сборки осуществляется с использованием **системы Gradle** — инструментария для автоматической сборки с помощью набора конфигурационных файлов.

### Запуск

При запуске приложения сначала запускается класс MainActivity, который
в качестве графического интерфейса устанавливает разметку из файла activity main.xml.
Но в классе Activity мы используем не файлы, а идентификаторы ресурсов: R.layout.activity main. Все идентификаторы ресурсов определены в классе R, который автоматически создается утилитой аpp и находится в файле R.java в каталоге build/generated/source/r/debug:

**Класс R** содержит идентификаторы для всех ресурсов, расположенных в каталоге res. Для каждого типа ресурсов в классе R создается внутренний класс (например, для всех графических ресурсов из каталога res/drawable создается класс R.drawable) и для каждого ресурса данного типа присваивается идентификатор. По этому идентификатору в последствии можно извлечь ресурс в файле кода.

Когда вы размещаете новый элемент на форме, с которым будете взаимодействовать в программе, то ему нужно присвоить идентификатор. Как правило, это происходит в  виде `@+id/editText1` (часто это происходит автоматически). Знак плюса обозначает, что если идентификатора не существует, то его нужно создать в классе R. В программе вы можете обращаться к элементу `R.id.editText1`.